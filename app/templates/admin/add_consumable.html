{% extends "base.html" %}

{% block title %}Verbrauchsmaterial hinzufügen{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Neues Verbrauchsmaterial hinzufügen</h1>
    
    <form method="POST" action="{{ url_for('add_consumable') }}" class="max-w-lg">
        <div class="space-y-4">
            <div>
                <label for="barcode" class="block text-sm font-medium text-gray-700">Barcode</label>
                <input type="text" name="barcode" id="barcode" required
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="bezeichnung" class="block text-sm font-medium text-gray-700">Bezeichnung</label>
                <input type="text" name="bezeichnung" id="bezeichnung" required
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="typ" class="block text-sm font-medium text-gray-700">Typ</label>
                <input type="text" name="typ" id="typ"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="ort" class="block text-sm font-medium text-gray-700">Ort</label>
                <input type="text" name="ort" id="ort"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="mindestbestand" class="block text-sm font-medium text-gray-700">Mindestbestand</label>
                <input type="number" name="mindestbestand" id="mindestbestand" min="0" value="1"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="aktueller_bestand" class="block text-sm font-medium text-gray-700">Aktueller Bestand</label>
                <input type="number" name="aktueller_bestand" id="aktueller_bestand" min="0" value="0"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="einheit" class="block text-sm font-medium text-gray-700">Einheit</label>
                <select name="einheit" id="einheit"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <option value="Stück">Stück</option>
                    <option value="Paar">Paar</option>
                    <option value="Packung">Packung</option>
                    <option value="Set">Set</option>
                    <option value="Rolle">Rolle</option>
                </select>
            </div>
        </div>
        
<<<<<<< Updated upstream:templates/add_consumable.html
        <div class="mt-6">
            <button type="submit" 
                    class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Hinzufügen
=======
        <form method="post" action="{{ url_for('admin.add_consumable') }}" enctype="multipart/form-data" class="space-y-4">
            <!-- Barcode-Feld zuerst -->
            <div class="mb-4">
                <label class="block text-sm font-medium">Barcode</label>
                <input type="text" 
                       name="barcode" 
                       id="barcodeInput" 
                       required
                       class="input input-bordered w-full"
                       autocomplete="off">
            </div>
            <div>
                <label class="block text-sm font-medium">Bezeichnung</label>
                <input type="text" name="name" required
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Typ</label>
                <input type="text" name="type"
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Lagerort</label>
                <input type="text" name="location" value="Lager"
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Mindestbestand</label>
                <input type="number" name="min_stock" value="1"
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Aktueller Bestand</label>
                <input type="number" name="current_stock" value="1"
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Einheit</label>
                <input type="text" name="unit" value="Stück"
                       class="input input-bordered w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Bild (max. 200KB)</label>
                <input type="file" 
                       name="image" 
                       id="imageInput"
                       accept="image/*"
                       class="file-input file-input-bordered w-full"
                       onchange="handleImageUpload(this)">
                <div id="imagePreview" class="mt-2"></div>
            </div>
            <script>
            async function handleImageUpload(input) {
                if (input.files && input.files[0]) {
                    try {
                        const processedImage = await processImage(input.files[0]);
                        
                        // Preview anzeigen
                        const preview = document.getElementById('imagePreview');
                        preview.innerHTML = `
                            <img src="${processedImage}" 
                                 class="max-w-[200px] rounded-lg shadow-lg" 
                                 alt="Vorschau">
                        `;
                        
                        // Processed image als Hidden Input speichern
                        let hiddenInput = document.getElementById('processedImage');
                        if (!hiddenInput) {
                            hiddenInput = document.createElement('input');
                            hiddenInput.type = 'hidden';
                            hiddenInput.name = 'processed_image';
                            hiddenInput.id = 'processedImage';
                            input.parentNode.appendChild(hiddenInput);
                        }
                        hiddenInput.value = processedImage;
                    } catch (error) {
                        console.error('Fehler bei der Bildverarbeitung:', error);
                        alert('Fehler bei der Bildverarbeitung. Bitte versuchen Sie es erneut.');
                    }
                }
            }
            </script>
            <button type="submit" class="btn bg-[#5b69a7] hover:bg-[#4c5789] text-white">
                Speichern
>>>>>>> Stashed changes:app/templates/admin/add_consumable.html
            </button>
            <a href="{{ url_for('consumables') }}" 
               class="ml-4 px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
                Abbrechen
            </a>
        </div>
    </form>
</div>
{% endblock %} 