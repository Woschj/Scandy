{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<!-- Hauptdashboard -->
<div id="main-tab">
    <!-- Server & Sync in eigener Reihe -->
    <div class="grid grid-cols-1 gap-6 mb-8">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">
                    <i class="fas fa-sync"></i>
                    Server & Sync
                </h2>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">Modus</div>
                        <div class="stat-value text-base-content">
                            {% if Config.SERVER_MODE %}
                            <span class="badge badge-primary">Server</span>
                            {% else %}
                            <span class="badge">Client</span>
                            {% endif %}
                        </div>
                        {% if Config.SERVER_MODE %}
                        <div class="stat-desc">Server-URL: http://{{ Config.SERVER_HOST }}:{{ Config.SERVER_PORT }}</div>
                        {% elif Config.SERVER_URL %}
                        <div class="stat-desc">Server: {{ Config.SERVER_URL }}</div>
                        {% endif %}
                    </div>
                    <div class="stat">
                        <div class="stat-actions">
                            <a href="{{ url_for('admin.server_settings') }}" 
                               class="btn btn-primary btn-block">
                                <i class="fas fa-cog mr-2"></i>
                                Einstellungen
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistik-Karten -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Werkzeuge -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Werkzeuge</h2>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">Gesamt</div>
                        <div class="stat-value text-base-content">{{ stats.tools.total }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Status</div>
                        <a href="{{ url_for('tools.index') }}?status=verfügbar"
                           class="stat-desc flex justify-between items-center hover:bg-base-200 p-2 rounded-lg cursor-pointer">
                            <span class="text-success flex items-center gap-2">
                                <i class="fas fa-check"></i>
                                {{ stats.tools.available }} verfügbar
                            </span>
                        </a>
                        <a href="{{ url_for('tools.index') }}?status=verliehen"
                           class="stat-desc flex justify-between items-center hover:bg-base-200 p-2 rounded-lg cursor-pointer">
                            <span class="text-warning flex items-center gap-2">
                                <i class="fas fa-exchange-alt"></i>
                                {{ stats.tools.lent }} verliehen
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mitarbeiter -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Mitarbeiter</h2>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">Gesamt</div>
                        <div class="stat-value text-base-content">{{ stats.workers.total }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Status</div>
                        <span class="stat-desc flex justify-between items-center p-2">
                            <span class="text-success flex items-center gap-2">
                                <i class="fas fa-user"></i>
                                {{ stats.workers.active }} aktiv
                            </span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verbrauchsmaterial -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Verbrauchsmaterial</h2>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">Gesamt</div>
                        <div class="stat-value text-base-content">{{ stats.consumables.total }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Bestand</div>
                        <a href="{{ url_for('consumables.index') }}?stock=sufficient"
                           class="stat-desc flex justify-between items-center hover:bg-base-200 p-2 rounded-lg cursor-pointer">
                            <span class="text-success flex items-center gap-2">
                                <i class="fas fa-check"></i>
                                {{ stats.consumables.sufficient }} ausreichend
                            </span>
                        </a>
                        <a href="{{ url_for('consumables.index') }}?stock=low"
                           class="stat-desc flex justify-between items-center hover:bg-base-200 p-2 rounded-lg cursor-pointer">
                            <span class="text-warning flex items-center gap-2">
                                <i class="fas fa-exclamation-triangle"></i>
                                {{ stats.consumables.low }} nachbestellen
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aktuelle Ausleihen -->
    <div class="grid grid-cols-2 gap-8 mt-8">
        <!-- Verbrauchsmaterial Ausgaben -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Aktuelle Materialausgaben</h2>
            <div class="overflow-y-auto max-h-96">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Menge</th>
                            <th>Mitarbeiter</th>
                            <th>Datum</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usage in consumable_usages %}
                        <tr>
                            <td>{{ usage.consumable_name }}</td>
                            <td>{{ usage.quantity }} Stk</td>
                            <td>{{ usage.worker_name }}</td>
                            <td>{{ usage.used_at|format_datetime }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Werkzeug Ausleihen -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Aktuelle Werkzeugausleihen</h2>
            <div class="overflow-y-auto max-h-96">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>Werkzeug</th>
                            <th>Mitarbeiter</th>
                            <th>Ausgeliehen seit</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lending in current_lendings %}
                        <tr class="{% if lending.overdue %}text-red-600{% endif %}">
                            <td>{{ lending.tool_name }}</td>
                            <td>{{ lending.worker_name }}</td>
                            <td>{{ lending.lent_at|format_datetime }}</td>
                            <td>
                                <button onclick="returnTool('{{ lending.tool_barcode }}')"
                                        class="btn btn-sm btn-primary">
                                    Rückgabe
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Nach den Statistik-Karten -->
    <div class="mt-8">
        <h2 class="text-xl font-semibold mb-4">Daten Export/Import</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Werkzeuge -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-lg">Werkzeuge</h3>
                    <div class="flex flex-col gap-2">
                        <a href="{{ url_for('admin.export_table', table='tools') }}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-download mr-2"></i>
                            Exportieren
                        </a>
                        <form action="{{ url_for('admin.import_table', table='tools') }}" 
                              method="post" 
                              enctype="multipart/form-data"
                              class="flex flex-col gap-2">
                            <input type="file" 
                                   name="file" 
                                   accept=".xlsx"
                                   class="file-input file-input-bordered file-input-sm w-full" />
                            <button type="submit" class="btn btn-secondary btn-sm">
                                <i class="fas fa-upload mr-2"></i>
                                Importieren
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Mitarbeiter -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-lg">Mitarbeiter</h3>
                    <div class="flex flex-col gap-2">
                        <a href="{{ url_for('admin.export_table', table='workers') }}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-download mr-2"></i>
                            Exportieren
                        </a>
                        <form action="{{ url_for('admin.import_table', table='workers') }}" 
                              method="post" 
                              enctype="multipart/form-data"
                              class="flex flex-col gap-2">
                            <input type="file" 
                                   name="file" 
                                   accept=".xlsx"
                                   class="file-input file-input-bordered file-input-sm w-full" />
                            <button type="submit" class="btn btn-secondary btn-sm">
                                <i class="fas fa-upload mr-2"></i>
                                Importieren
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Verbrauchsmaterial -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-lg">Verbrauchsmaterial</h3>
                    <div class="flex flex-col gap-2">
                        <a href="{{ url_for('admin.export_table', table='consumables') }}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-download mr-2"></i>
                            Exportieren
                        </a>
                        <form action="{{ url_for('admin.import_table', table='consumables') }}" 
                              method="post" 
                              enctype="multipart/form-data"
                              class="flex flex-col gap-2">
                            <input type="file" 
                                   name="file" 
                                   accept=".xlsx"
                                   class="file-input file-input-bordered file-input-sm w-full" />
                            <button type="submit" class="btn btn-secondary btn-sm">
                                <i class="fas fa-upload mr-2"></i>
                                Importieren
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Verlauf -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-lg">Verlauf</h3>
                    <div class="flex flex-col gap-2">
                        <a href="{{ url_for('admin.export_table', table='history') }}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-download mr-2"></i>
                            Exportieren
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 