{% extends "shared/list_base.html" %}

{% block actions %}
{% if is_admin %}
<div class="flex gap-2">
    <a href="{{ url_for('consumables.add') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Neues Verbrauchsmaterial
    </a>
</div>
{% endif %}
{% endblock %}

{% block filters %}
<select class="select select-bordered w-full max-w-xs" id="categoryFilter">
    <option value="">Alle Kategorien</option>
    {% for category in categories %}
    <option value="{{ category }}">{{ category }}</option>
    {% endfor %}
</select>

<select class="select select-bordered w-full max-w-xs" id="locationFilter">
    <option value="">Alle Standorte</option>
    {% for location in locations %}
    <option value="{{ location }}">{{ location }}</option>
    {% endfor %}
</select>

<select class="select select-bordered w-full max-w-xs" id="stockFilter">
    <option value="">Alle Best채nde</option>
    <option value="in_stock">Verf체gbar</option>
    <option value="low_stock">Niedriger Bestand</option>
    <option value="out_of_stock">Nicht verf체gbar</option>
</select>
{% endblock %}

{% block table_headers %}
<th>Name</th>
<th>Barcode</th>
<th>Standort</th>
<th>Bestand</th>
<th>Kategorie</th>
{% if is_admin %}
<th class="text-right">Aktionen</th>
{% endif %}
{% endblock %}

{% block table_rows %}
{% for item in items %}
<tr class="hover data-row" 
    data-category="{{ item.category }}"
    data-location="{{ item.location }}"
    data-stock="{{ 'out_of_stock' if item.stock == 0 else 'low_stock' if item.stock < item.min_stock else 'in_stock' }}">
    <td>
        <a href="{{ url_for('consumables.details', barcode=item.barcode) }}" class="link link-hover font-medium">
            {{ item.name }}
        </a>
    </td>
    <td><code>{{ item.barcode }}</code></td>
    <td>{{ item.location }}</td>
    <td>
        <span class="badge {{ 'badge-error' if item.stock == 0 else 'badge-warning' if item.stock < item.min_stock else 'badge-success' }} gap-1">
            <i class="fas fa-box"></i>
            {{ item.stock }} / {{ item.min_stock }}
        </span>
    </td>
    <td>{{ item.category }}</td>
    {% if is_admin %}
    <td class="text-right">
        <div class="btn-group">
            <button class="btn btn-sm" onclick="editConsumable('{{ item.barcode }}')">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-error" onclick="deleteConsumable('{{ item.barcode }}')">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </td>
    {% endif %}
</tr>
{% endfor %}
{% endblock %}

{% block list_scripts %}
// Suchfunktion
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    document.querySelectorAll('.data-row').forEach(row => {
        const searchableContent = row.textContent.toLowerCase();
        row.style.display = searchableContent.includes(searchTerm) ? '' : 'none';
    });
});

// Filter-Funktionalit채t
function applyFilters() {
    const category = document.getElementById('categoryFilter').value;
    const location = document.getElementById('locationFilter').value;
    const stock = document.getElementById('stockFilter').value;
    
    document.querySelectorAll('.data-row').forEach(row => {
        const matchesCategory = !category || row.dataset.category === category;
        const matchesLocation = !location || row.dataset.location === location;
        const matchesStock = !stock || row.dataset.stock === stock;
        
        row.style.display = (matchesCategory && matchesLocation && matchesStock) ? '' : 'none';
    });
}

document.getElementById('categoryFilter').addEventListener('change', applyFilters);
document.getElementById('locationFilter').addEventListener('change', applyFilters);
document.getElementById('stockFilter').addEventListener('change', applyFilters);
{% endblock %} 